# Specify the parameters enclosed in angle brackets.
# Run the follows command to get help for details of configuration:
# java -jar billing-1.0.jar --help conf
# java -jar billing-1.0.jar --help {adapter | parser | filter | logappender} [name]

<#assign LOG_ROOT_DIR="/var/opt/dlab/log">
<#assign DEV_MODE="false">

# Working file for store billing report variables.
workingFile: /opt/dlab/tmp/result/billing-data.json

scheduler:
# Schedule is comma separated values of time in format hh[:mm[:ss]]. hh - in the 24-hour clock, at 8:15PM is 20:15.
  schedule: 0:00, 3:00, 6:00, 9:00, 12:00, 15:00, 18:00, 21:00

# Adapter for reading source data. Known types: file, s3file
adapterIn:
  - type: s3file
    bucket: <BILLING_BUCKET_NAME>
    path: <REPORT_PATH>
    accountId: <ACCOUNT_ID>
    accessKeyId: <ACCESS_KEY_ID>
    secretAccessKey: <SECRET_ACCESS_KEY>

# Adapter for writing converted data. Known types: console, file, s3file, mongodb
adapterOut:
  - type: mongodlab
    host: localhost
    port: 27017
    username: admin
    password: <MONGODB_PASSWORD>
    database: dlabdb
#    bufferSize: 10000
    upsert: true

# Filter for source and converted data.
filter:
  - type: aws
    currencyCode: USD
    columnDlabTag: user:<CONF_TAG_RESOURCE_ID>
    serviceBaseName: <CONF_SERVICE_BASE_NAME>

# Parser of source data to common format.
parser:
  - type: csv
    headerLineNo: 1
    skipLines: 1
    columnMapping: >-
      dlab_id=user:user:tag;usage_date=UsageStartDate;product=ProductName;
      usage_type=UsageType;usage=UsageQuantity;cost=BlendedCost;
      resource_id=ResourceId;tags=Operation,ItemDescription
    aggregate: day


# Logging configuration.
#logging:
  # Default logging level
#  level: INFO
  # Logging levels for appenders.
#  loggers:
#    com.epam: DEBUG
#    org.apache.http: WARN
#    org.mongodb.driver: WARN
#    org.hibernate: WARN
  # Logging appenders
#  appenders:
#<#if DEV_MODE == "true">
#    - type: console
#</#if>
#    - type: file
#      currentLogFilename: ${LOG_ROOT_DIR}/ssn/billing.log
#      archive: true
#      archivedLogFilenamePattern: ${LOG_ROOT_DIR}/ssn/billing-%d{yyyy-MM-dd}.log.gz
#      archivedFileCount: 10
