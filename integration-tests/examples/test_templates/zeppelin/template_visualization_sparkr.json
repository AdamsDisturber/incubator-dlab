{"paragraphs":[{"text":"%INTERPRETER_NAME\nsparkR.session()\n\nfull_path <- function(file_path) {\n    working_bucket <- \"S3_BUCKET\"\n    output_directory <- \"processed_zeppelin_sparkr\"\n    sprintf(\"s3a://%s/%s/%s\", working_bucket, output_directory, file_path)\n}","user":"anonymous","dateUpdated":"2017-03-29T11:26:41+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r","editOnDblClick":false},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786654890_1988737249","id":"20170329-112414_1472595813","dateCreated":"2017-03-29T11:24:14+0000","dateStarted":"2017-03-29T11:26:41+0000","dateFinished":"2017-03-29T11:26:41+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6749"},{"text":"%INTERPRETER_NAME\ncarriers <- read.df(full_path(\"carriers\"), \"parquet\")\ncreateOrReplaceTempView(carriers, \"carriers\")\nprintSchema(carriers)\nhead(carriers, 20)","user":"anonymous","dateUpdated":"2017-03-29T11:26:45+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r"},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786689369_1284323310","id":"20170329-112449_1638412317","dateCreated":"2017-03-29T11:24:49+0000","dateStarted":"2017-03-29T11:26:45+0000","dateFinished":"2017-03-29T11:26:46+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6750"},{"text":"%INTERPRETER_NAME\nairports <- read.df(full_path(\"airports\"), \"parquet\")\ncreateOrReplaceTempView(airports, \"airports\")\nprintSchema(airports)\nhead(airports, 20)","user":"anonymous","dateUpdated":"2017-03-29T11:26:49+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r"},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786710108_554854719","id":"20170329-112510_202152993","dateCreated":"2017-03-29T11:25:10+0000","dateStarted":"2017-03-29T11:26:49+0000","dateFinished":"2017-03-29T11:26:51+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6751"},{"text":"%INTERPRETER_NAME\nflights <- read.df(full_path(\"flights\"), \"parquet\")\ncreateOrReplaceTempView(flights, \"flights\")\nprintSchema(flights)\nhead(flights, 10)[c(\"ArrDelay\",\"CarrierDelay\",\"WeatherDelay\",\"Distance\")]","user":"anonymous","dateUpdated":"2017-03-29T11:26:53+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r"},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786723048_-442035138","id":"20170329-112523_1571758659","dateCreated":"2017-03-29T11:25:23+0000","dateStarted":"2017-03-29T11:26:53+0000","dateFinished":"2017-03-29T11:26:55+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6752"},{"text":"%INTERPRETER_NAME\nhead(summary(flights))[c(\"summary\", \"ArrDelay\",\"CarrierDelay\",\"Distance\")]","user":"anonymous","dateUpdated":"2017-03-29T11:26:58+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r"},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786735624_2067697261","id":"20170329-112535_1375397859","dateCreated":"2017-03-29T11:25:35+0000","dateStarted":"2017-03-29T11:26:58+0000","dateFinished":"2017-03-29T11:27:28+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6753"},{"text":"%INTERPRETER_NAME\nlibrary(ggplot2)\nlibrary(reshape2)\n\ndelay_sql <- sql(\"\nSELECT SUBSTR(c.description, 0, 15) as Carrier, WorkDayDelay, WeekendDelay \nFROM\n       (SELECT CEIL( AVG(f.ArrDelay + f.DepDelay) ) as WorkDayDelay, f.UniqueCarrier\n        FROM flights f\n        WHERE f.DayOfWeek < 6\n        GROUP BY f.UniqueCarrier \n        ORDER BY WorkDayDelay desc \n        LIMIT 10) t\n    JOIN\n       (SELECT CEIL( AVG(f.ArrDelay + f.DepDelay) ) as WeekendDelay, f.UniqueCarrier\n        FROM flights f\n        WHERE f.DayOfWeek > 5\n        GROUP BY f.UniqueCarrier) t1\n      ON t.UniqueCarrier = t1.UniqueCarrier\n    JOIN carriers c \n      ON t.UniqueCarrier = c.code \nORDER BY WeekendDelay DESC, WorkDayDelay DESC\n\")\n\ndelay <- collect(delay_sql)\ndelay_melt <- melt(delay[c('Carrier', 'WorkDayDelay', 'WeekendDelay')])\n\ncolor_range_days <- c(\"#2966FF\", \"#61F2FF\")\n\nggplot(data=delay_melt, aes(x=Carrier, y=value, fill=variable)) +\n    geom_bar(stat=\"identity\", width=.7, position=\"dodge\") +\n    stat_summary(fun.y=mean, geom = \"line\", mapping = aes(group = 1), color=\"red\") +\n    stat_summary(fun.y=mean, geom = \"point\", mapping = aes(group = 1), color=\"red\") +\n    theme(legend.position=\"right\", axis.text.x=element_text(angle=90)) +\n    labs(x=\"Carrier\", y=\"Minutes\", fill=\"Day Type\") +\n    coord_fixed(ratio = .2) +\n    scale_fill_manual(values=color_range_days) +\n    scale_y_continuous(breaks=seq(0, 30, 5))","user":"anonymous","dateUpdated":"2017-03-29T11:27:32+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r","editOnDblClick":false},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786749542_-566663133","id":"20170329-112549_2110062261","dateCreated":"2017-03-29T11:25:49+0000","dateStarted":"2017-03-29T11:27:32+0000","dateFinished":"2017-03-29T11:27:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6754"},{"text":"%INTERPRETER_NAME\ntop_flights_sql <- sql(\"\nSELECT t.cnt as FlightsAmt, carriers.description as Carrier \nFROM (\n    SELECT count(*) as cnt, flights.UniqueCarrier as carrier_code \n    FROM flights \n    GROUP BY flights.UniqueCarrier LIMIT 6) t \nLEFT JOIN carriers \n  ON t.carrier_code = carriers.code\n\")\n\ntop_flights <- collect(top_flights_sql)\n\nggplot(transform(transform(top_flights, value=FlightsAmt/sum(FlightsAmt)), labPos=cumsum(FlightsAmt)-FlightsAmt/2), \n       aes(x=\"\", y = FlightsAmt, fill = Carrier)) +\n    geom_bar(width = 1, stat = \"identity\") +\n    coord_polar(\"y\", start=0) +\n    scale_fill_brewer(palette=\"Dark2\") +\n    theme_bw() +\n    theme(axis.text.x=element_blank() ,panel.grid.major=element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank()) +\n    geom_text(size=4, aes(y=labPos, label=scales::percent(value))) + \n    geom_text(size=3, aes(x=1.8, y=labPos, label=top_flights$Carrier)) + \n    theme(legend.position=\"none\")","user":"anonymous","dateUpdated":"2017-03-29T11:28:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r"},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786767436_-1582000157","id":"20170329-112607_812774791","dateCreated":"2017-03-29T11:26:07+0000","dateStarted":"2017-03-29T11:28:38+0000","dateFinished":"2017-03-29T11:28:40+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6755"},{"text":"%INTERPRETER_NAME\ndistance_sql = sql(\"\nSELECT SUBSTR(c.description, 0, 15) as Carrier, COUNT(Distance) AS Distance \nFROM flights f \nJOIN carriers c \n  ON f.UniqueCarrier = c.code \nGROUP BY c.description \nORDER BY distance DESC \nLIMIT 10\n\")\n\ndistance <- collect(distance_sql)\n\ndistance$Carrier <- factor(distance$Carrier, levels = distance$Carrier[order(-distance$Distance)])\n\ncolor_range <-  c(\"#2966FF\", \"#2E73FF\",\"#3380FF\", \"#388CFF\", \"#3D99FF\", \"#42A6FF\", \"#47B2FF\", \"#4CBFFF\", \"#52CCFF\", \n                  \"#57D9FF\", \"#5CE6FF\", \"#61F2FF\", \"#66FFFF\")\n\nggplot(data=distance, aes(x=Carrier, y=Distance, fill=Carrier)) +\n    geom_bar(stat=\"identity\", width=.7, position=\"dodge\") +\n    theme(axis.text.x=element_text(angle=90)) +\n    scale_fill_manual(values=color_range) +\n    theme(legend.position=\"none\")","user":"anonymous","dateUpdated":"2017-03-29T11:29:49+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r"},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786783858_-406360760","id":"20170329-112623_1822577399","dateCreated":"2017-03-29T11:26:23+0000","dateStarted":"2017-03-29T11:29:49+0000","dateFinished":"2017-03-29T11:29:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6756"},{"text":"%INTERPRETER_NAME\n","user":"anonymous","dateUpdated":"2017-03-29T11:28:49+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"r"},"editorMode":"ace/mode/r"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1490786929910_-167200186","id":"20170329-112849_1309419273","dateCreated":"2017-03-29T11:28:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6757"}],"name":"Flights_Visualization_SparkR","id":"2CF54K14Y","angularObjects":{"2C6RJRBD2:shared_process":[],"2C6RJRBD1:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}
